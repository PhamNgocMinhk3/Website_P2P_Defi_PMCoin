<div class="relative" (click)="toggleDropdown($event)">
  <button class="relative z-10 block p-2 text-gray-700 bg-white border border-transparent rounded-md dark:text-white focus:border-blue-500 focus:ring-opacity-40 dark:focus:ring-opacity-40 focus:ring-blue-300 dark:focus:ring-blue-400 focus:ring dark:bg-gray-800 focus:outline-none">
    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M15 17H20L18.5951 15.5951C18.2141 15.2141 18 14.6973 18 14.1585V11C18 8.38757 16.3304 6.16509 14 5.34142V5C14 3.89543 13.1046 3 12 3C10.8954 3 10 3.89543 10 5V5.34142C7.66962 6.16509 6 8.38757 6 11V14.1585C6 14.6973 5.78595 15.2141 5.40493 15.5951L4 17H9M15 17V18C15 19.6569 13.6569 21 12 21C10.3431 21 9 19.6569 9 18V17M15 17H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
    <span *ngIf="unreadCount > 0" class="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-100 transform translate-x-1/2 -translate-y-1/2 bg-red-600 rounded-full">
      {{ unreadCount > 99 ? '99+' : unreadCount }}
    </span>
  </button>

  <div *ngIf="isOpen" class="absolute right-0 z-20 w-80 py-2 mt-2 overflow-hidden bg-white rounded-md shadow-xl dark:bg-gray-800">
    <div class="flex justify-between items-center px-4 py-2">
      <h3 class="text-lg font-medium text-gray-800 dark:text-white">Thông báo</h3>
      <button (click)="markAllAsRead()" class="text-sm font-medium text-blue-600 dark:text-blue-400 hover:underline">
        Xác nhận đọc hết
      </button>
    </div>

    <hr class="border-gray-200 dark:border-gray-700">

    <div *ngIf="displayedNotifications.length > 0; else noNotifications">
      <a *ngFor="let notification of displayedNotifications"
         (click)="onNotificationClick(notification)"
         class="flex items-center px-4 py-3 -mx-2 transition-colors duration-300 transform border-b border-gray-200 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer"
         [class.bg-gray-50]="!notification.isRead"
         [class.dark:bg-gray-900]="!notification.isRead">

        <img class="object-cover w-8 h-8 mx-1 rounded-full" [src]="notification.senderAvatar || 'assets/images/users/avatar-2.jpg'" alt="avatar">

        <div class="mx-2">
          <p class="text-sm font-semibold text-gray-700 dark:text-gray-200">
            {{ notification.senderName }}
          </p>
          <p class="text-sm text-gray-600 dark:text-gray-400 truncate w-60">
            {{ notification.messageContent }}
          </p>
          <p class="text-xs text-gray-500 dark:text-gray-500">
            {{ notification.timestamp | timeAgo }}
          </p>
        </div>
      </a>
    </div>

    <ng-template #noNotifications>
      <div class="px-4 py-8 text-center">
        <p class="text-gray-500 dark:text-gray-400">No new notifications</p>
      </div>
    </ng-template>
  </div>
</div>