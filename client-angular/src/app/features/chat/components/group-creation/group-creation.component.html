<div *ngIf="isVisible" class="modal-overlay" (click)="onClose()">
  <div class="group-creation-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>ğŸ‘¥ {{ isAddMemberMode ? 'ThÃªm thÃ nh viÃªn' : 'Táº¡o nhÃ³m chat' }}</h3>
      <button class="close-btn" (click)="onClose()">
        <i class="fa-solid fa-times"></i>
      </button>
    </div>

    <div class="modal-content">
      <!-- Group Name Input -->
      <div class="form-group" *ngIf="!isAddMemberMode">
        <label for="groupName">TÃªn nhÃ³m</label>
        <input id="groupName" type="text" [(ngModel)]="groupName" placeholder="Nháº­p tÃªn nhÃ³m chat..."
          class="group-name-input" maxlength="50" />
        <div class="char-count">{{ groupName.length }}/50</div>
      </div>

      <!-- Selected Users -->
      <div class="selected-users" *ngIf="selectedUsers.length > 0">
        <h4>ThÃ nh viÃªn Ä‘Ã£ chá»n ({{ selectedUsers.length }})</h4>
        <div class="selected-list">
          <div *ngFor="let user of selectedUsers; trackBy: trackByUserId" class="selected-user">
            <img [src]="user.avatar" [alt]="user.name" class="user-avatar" />
            <span class="user-name">{{ user.name }}</span>
            <button class="remove-btn" (click)="removeSelectedUser(user)" title="XÃ³a khá»i nhÃ³m">
              <i class="fa-solid fa-times"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- User Search -->
      <div class="form-group">
        <label for="userSearch">ThÃªm thÃ nh viÃªn</label>
        <div class="search-box">
          <i class="fa-solid fa-search search-icon"></i>
          <input id="userSearch" type="text" [(ngModel)]="searchTerm" (input)="onSearchChange()"
            placeholder="TÃ¬m kiáº¿m ngÆ°á»i dÃ¹ng..." class="search-input" />
        </div>
      </div>

      <!-- Available Users -->
      <div class="users-list">
        <div *ngFor="let user of filteredUsers; trackBy: trackByUserId" class="user-item"
          [class.selected]="isUserSelected(user)" (click)="toggleUserSelection(user)">
          <img [src]="user.avatar" [alt]="user.name" class="user-avatar" />
          <div class="user-info">
            <div class="user-name">{{ user.name }}</div>
            <div class="user-status" [class.active]="user.active">
              {{ user.active ? 'Äang hoáº¡t Ä‘á»™ng' : 'Ngoáº¡i tuyáº¿n' }}
            </div>
          </div>
          <div class="selection-indicator">
            <i class="fa-solid" [class.fa-check]="isUserSelected(user)" [class.fa-plus]="!isUserSelected(user)"></i>
          </div>
        </div>

        <div *ngIf="filteredUsers.length === 0" class="empty-state">
          <div class="empty-icon">ğŸ‘¥</div>
          <p *ngIf="searchTerm">KhÃ´ng tÃ¬m tháº¥y ngÆ°á»i dÃ¹ng nÃ o vá»›i tá»« khÃ³a "{{ searchTerm }}"</p>
          <p *ngIf="!searchTerm && selectedUsers.length === availableUsers.length">
            Táº¥t cáº£ ngÆ°á»i dÃ¹ng Ä‘Ã£ Ä‘Æ°á»£c chá»n
          </p>
          <p *ngIf="!searchTerm && selectedUsers.length < availableUsers.length">
            KhÃ´ng cÃ³ thÃªm ngÆ°á»i dÃ¹ng nÃ o
          </p>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="onClose()">
        Há»§y
      </button>
      <button class="btn btn-primary" [disabled]="!canCreateGroup()" (click)="confirmAction()">
        <i class="fa-solid" [class.fa-users]="!isAddMemberMode" [class.fa-user-plus]="isAddMemberMode"></i>
        {{ isAddMemberMode ? 'ThÃªm' : 'Táº¡o nhÃ³m' }}
      </button>
    </div>

    <!-- Requirements Info -->
    <div class="requirements-info" *ngIf="!canCreateGroup()">
      <div class="requirement" [class.met]="groupName.trim().length > 0">
        <i class="fa-solid fa-check" *ngIf="groupName.trim().length > 0"></i>
        <i class="fa-solid fa-times" *ngIf="groupName.trim().length === 0"></i>
        Cáº§n nháº­p tÃªn nhÃ³m
      </div>
      <div class="requirement" [class.met]="selectedUsers.length >= 2">
        <i class="fa-solid fa-check" *ngIf="selectedUsers.length >= 2"></i>
        <i class="fa-solid fa-times" *ngIf="selectedUsers.length < 2"></i>
        Cáº§n Ã­t nháº¥t 2 thÃ nh viÃªn
      </div>
    </div>
  </div>
</div>