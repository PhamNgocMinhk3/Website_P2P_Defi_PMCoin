<div class="analysis-container">
  <!-- Header -->
  <div class="analysis-header">
    <h1 class="page-title">
      <span class="title-icon">ü§ñ</span>
      Bot Ph√¢n T√≠ch AI
    </h1>
    <p class="page-subtitle">Ph√¢n t√≠ch th·ªã tr∆∞·ªùng crypto v·ªõi d·ªØ li·ªáu Binance th·ªùi gian th·ª±c</p>

    <div class="header-controls">
      <div class="connection-status" [class]="getConnectionStatusClass()">
        <span class="status-dot"></span>
        <span class="status-text">{{ getConnectionStatusText() }}</span>
      </div>
      <div class="last-update">
        <span class="update-label">C·∫≠p nh·∫≠t l·∫ßn cu·ªëi:</span>
        <span class="update-time">{{ lastUpdate | date:'HH:mm:ss' }}</span>
        <span class="update-counter">(#{{ updateCounter }})</span>
      </div>
      <button class="refresh-btn" (click)="refreshData()" [disabled]="isLoading">
        <span class="refresh-icon" [class.spinning]="isLoading">üîÑ</span>
        L√†m m·ªõi
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-section" *ngIf="isLoading">
    <div class="loading-spinner">‚è≥</div>
    <p>ƒêang t·∫£i d·ªØ li·ªáu th·ªã tr∆∞·ªùng...</p>
  </div>

  <!-- Main Content -->
  <div class="analysis-content" *ngIf="!isLoading">
    <!-- Market Overview -->
    <div class="market-overview">
      <h2>T·ªïng quan th·ªã tr∆∞·ªùng</h2>
      <div class="market-grid">
        <div class="market-card" *ngFor="let data of marketData" [class.selected]="selectedSymbol === data.symbol"
          (click)="selectSymbol(data.symbol)">
          <div class="card-header">
            <h3>{{ data.symbol }}</h3>
            <span class="trend-badge" [class]="getTrendClass(data.trend)">
              {{ data.trend }}
            </span>
          </div>

          <div class="price-info">
            <div class="current-price">${{ formatPrice(data.currentPrice) }}</div>
            <div class="price-change" [class]="getChangeClass(data.priceChangePercent24h)">
              {{ formatPercentage(data.priceChangePercent24h) }}
            </div>
          </div>

          <div class="recommendation-info">
            <span class="recommendation" [class]="getRecommendationClass(data.recommendation)">
              {{ data.recommendation }}
            </span>
            <span class="confidence">{{ data.confidence.toFixed(0) }}%</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Detailed Analysis -->
    <div class="detailed-analysis" *ngIf="selectedAnalysis">
      <h2>Ph√¢n t√≠ch chi ti·∫øt - {{ selectedAnalysis.symbol }}</h2>

      <div class="analysis-grid">
        <!-- Price Analysis -->
        <div class="analysis-card price-analysis">
          <h3>üìä Ph√¢n t√≠ch gi√°</h3>
          <div class="analysis-content">
            <div class="metric">
              <span class="metric-label">Gi√° hi·ªán t·∫°i:</span>
              <span class="metric-value">${{ formatPrice(selectedAnalysis.currentPrice) }}</span>
            </div>
            <div class="metric">
              <span class="metric-label">Thay ƒë·ªïi 24h:</span>
              <span class="metric-value" [class]="getChangeClass(selectedAnalysis.priceChange24h)">
                ${{ formatPrice(selectedAnalysis.priceChange24h) }}
                ({{ formatPercentage(selectedAnalysis.priceChangePercent24h) }})
              </span>
            </div>
            <div class="metric">
              <span class="metric-label">Kh·ªëi l∆∞·ª£ng 24h:</span>
              <span class="metric-value">{{ formatVolume(selectedAnalysis.volume24h) }}</span>
            </div>
          </div>
        </div>

        <!-- Technical Analysis -->
        <div class="analysis-card technical-analysis">
          <h3>üìà Ph√¢n t√≠ch k·ªπ thu·∫≠t</h3>
          <div class="analysis-content">
            <div class="metric">
              <span class="metric-label">Xu h∆∞·ªõng:</span>
              <span class="metric-value trend-value" [class]="getTrendClass(selectedAnalysis.trend)">
                {{ selectedAnalysis.trend }}
              </span>
            </div>
            <div class="metric">
              <span class="metric-label">RSI:</span>
              <span class="metric-value">{{ selectedAnalysis.rsi.toFixed(1) }}</span>
            </div>
            <div class="metric">
              <span class="metric-label">H·ªó tr·ª£:</span>
              <span class="metric-value">${{ formatPrice(selectedAnalysis.support) }}</span>
            </div>
            <div class="metric">
              <span class="metric-label">Kh√°ng c·ª±:</span>
              <span class="metric-value">${{ formatPrice(selectedAnalysis.resistance) }}</span>
            </div>
          </div>
        </div>

        <!-- Trading Signal -->
        <div class="analysis-card trading-signal">
          <h3>üéØ T√≠n hi·ªáu giao d·ªãch</h3>
          <div class="analysis-content">
            <div class="signal-main">
              <div class="recommendation-large" [class]="getRecommendationClass(selectedAnalysis.recommendation)">
                {{ selectedAnalysis.recommendation }}
              </div>
              <div class="confidence-meter">
                <div class="confidence-label">ƒê·ªô tin c·∫≠y</div>
                <div class="confidence-bar">
                  <div class="confidence-fill" [style.width.%]="selectedAnalysis.confidence"
                    [style.background-color]="getConfidenceColor(selectedAnalysis.confidence)">
                  </div>
                </div>
                <div class="confidence-value">{{ selectedAnalysis.confidence.toFixed(0) }}%</div>
              </div>
            </div>
          </div>
        </div>

        <!-- AI Insights -->
        <div class="analysis-card ai-insights">
          <h3>ü§ñ Nh·∫≠n ƒë·ªãnh AI</h3>
          <div class="analysis-content">
            <div class="insight-item" *ngIf="selectedAnalysis.trend === 'BULLISH'">
              <span class="insight-icon">üìà</span>
              <span class="insight-text">Th·ªã tr∆∞·ªùng ƒëang trong xu h∆∞·ªõng tƒÉng. RSI ·ªü m·ª©c {{
                selectedAnalysis.rsi.toFixed(1) }}.</span>
            </div>
            <div class="insight-item" *ngIf="selectedAnalysis.trend === 'BEARISH'">
              <span class="insight-icon">üìâ</span>
              <span class="insight-text">Th·ªã tr∆∞·ªùng ƒëang trong xu h∆∞·ªõng gi·∫£m. C·∫ßn th·∫≠n tr·ªçng khi ƒë·∫ßu t∆∞.</span>
            </div>
            <div class="insight-item" *ngIf="selectedAnalysis.trend === 'NEUTRAL'">
              <span class="insight-icon">‚û°Ô∏è</span>
              <span class="insight-text">Th·ªã tr∆∞·ªùng ƒëang sideway. Ch·ªù t√≠n hi·ªáu r√µ r√†ng h∆°n.</span>
            </div>

            <div class="insight-item" *ngIf="selectedAnalysis.rsi > 70">
              <span class="insight-icon">‚ö†Ô∏è</span>
              <span class="insight-text">RSI cao ({{ selectedAnalysis.rsi.toFixed(1) }}), c√≥ th·ªÉ b·ªã qu√° mua.</span>
            </div>
            <div class="insight-item" *ngIf="selectedAnalysis.rsi < 30">
              <span class="insight-icon">üí°</span>
              <span class="insight-text">RSI th·∫•p ({{ selectedAnalysis.rsi.toFixed(1) }}), c√≥ th·ªÉ b·ªã qu√° b√°n.</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions" *ngIf="selectedAnalysis">
      <h3>‚ö° H√†nh ƒë·ªông nhanh</h3>
      <div class="action-buttons">
        <button class="action-btn buy-btn" *ngIf="selectedAnalysis.recommendation === 'BUY'">
          <span class="btn-icon">üìà</span>
          <span class="btn-text">Mua {{ selectedAnalysis.symbol }}</span>
        </button>
        <button class="action-btn sell-btn" *ngIf="selectedAnalysis.recommendation === 'SELL'">
          <span class="btn-icon">üìâ</span>
          <span class="btn-text">B√°n {{ selectedAnalysis.symbol }}</span>
        </button>
        <button class="action-btn hold-btn" *ngIf="selectedAnalysis.recommendation === 'HOLD'">
          <span class="btn-icon">‚è∏Ô∏è</span>
          <span class="btn-text">Gi·ªØ {{ selectedAnalysis.symbol }}</span>
        </button>
        <button class="action-btn alert-btn" (click)="toggleEmailAlerts()" [class.active]="isEmailAlertEnabled">
          <span class="btn-icon">
            <ng-container *ngIf="isEmailAlertEnabled; else bellIcon">üîï</ng-container>
            <ng-template #bellIcon>üîî</ng-template>
          </span>
          <span class="btn-text">
            <ng-container *ngIf="isEmailAlertEnabled; else enableText">T·∫Øt c·∫£nh b√°o</ng-container>
            <ng-template #enableText>ƒê·∫∑t c·∫£nh b√°o</ng-template>
          </span>
        </button>
      </div>
    </div>

    <!-- Disclaimer -->
    <div class="disclaimer">
      <h4>‚ö†Ô∏è L∆∞u √Ω quan tr·ªçng</h4>
      <p>
        ƒê√¢y ch·ªâ l√† c√¥ng c·ª• ph√¢n t√≠ch h·ªó tr·ª£ v√† kh√¥ng ph·∫£i l·ªùi khuy√™n ƒë·∫ßu t∆∞.
        Vui l√≤ng t·ª± nghi√™n c·ª©u v√† ƒë√°nh gi√° r·ªßi ro tr∆∞·ªõc khi ƒë∆∞a ra quy·∫øt ƒë·ªãnh giao d·ªãch.
        Th·ªã tr∆∞·ªùng cryptocurrency c√≥ t√≠nh bi·∫øn ƒë·ªông cao v√† c√≥ th·ªÉ g√¢y thua l·ªó.
      </p>
    </div>
  </div>
</div>